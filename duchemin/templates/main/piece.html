{% extends "base.html" %}
{% load template_dict %}

{% block header %}
  <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/themes/base/jquery-ui.css" rel="stylesheet"></link>
  <script src="{{ STATIC_URL }}js/notation.js"></script>
  <script type="text/javascript" src="http://vm-duchemin.haverford.edu:8080/assets/scripts/libs/vexflow-free.js"></script>
  <script type="text/javascript" src="http://vm-duchemin.haverford.edu:8080/assets/scripts/libs/meitovexflow.js"></script>
  <script type="text/javascript">
    $(document).ready(function (){
        attachAnalysisClickEvents();
    });
  </script>
{% endblock %}

{% block wrap %}
      <div class="row-fluid">
        <div class="span12">
          <div class="show-heading row-fluid">
            <hgroup class="show-title page-title span8">
              <h1>{{ piece.title }}</h1>
              <h2>{{ piece.composer_id.full_name }}</h2>
              <h3>{{ piece.piece_id }}</h3>
            </hgroup>
            <div class="well span4">
              <dl class="well-list account-info-list">
                <dt>Source:</dt>
                <dd><a href="/book/{{ piece.book_id.book_id }}">{{ piece.book_id.title }}</a></dd>
                <dt>View:</dt>
                <dd><a href="#">Complete Modern Edition</a></dd>
                <dd><a href="#">Translation</a></dd>
                <dt>Listen:</dt>
                <dd><a href="#"><i class="icon-music"></i> MP3 (1:23)</a></dd>
              </dl>
            </div>
          </div>
          <div class="row-fluid">
            <div class="span8 show-container content-container">
              <div class="filter-container">
                <div id="show-filter" class="show-filter btn-group">
                  <button id="measure-btn" class="btn btn-small active">Measures</button>
                  <button id="rhyme-btn" class="btn btn-small active">Rhyme</button>
                  <button id="commonplaces-btn" class="btn btn-small">Analysis</button>
                </div>
              </div>
              <div class="item-display">
                {% for phrase in phrases %}
                <div class="line">
                  <span class="measure span1">
                    {% if phrase.phrase_start %}
                      {{ phrase.phrase_start }}&ndash;{{ phrase.phrase_stop }}
                    {% endif %}
                    </span>
                  <span class="rhyme span1">
                    {% if phrase.rhyme %}
                      {{ phrase.rhyme }}
                    {% endif %}
                    </span>
                  <span class="line-text span7">{{ phrase.phrase_text }}</span>
                  <div class="dropdown notation-dropdown">
                    <a href="#">View</a>
                  </div>
                  <div class="commonplaces span12">
                    <ul>
                      <li><a href="#">Commonplace 1</a></li>
                    </ul>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div><!--/span-->
            <div id="sidebar" class="span4">
              <h3>Favourites</h3>
              {% if is_favourite %}
              <p><a href="/favourite/piece/{{ piece.id }}?remove"><i class="icon-star-empty"></i> Remove from Favourites</a></p>
              {% else %}
              <p><a href="/favourite/piece/{{ piece.id }}?add" class="add-to-favourites"><i class="icon-star"></i> Add to Favorites</a></p>
              {% endif %}
              <h3>Notes</h3>
              <p>Notes go here.</p>
            </div><!--/span-->
            <div class="span12">
              {% if analyses %}
              <div class="analysis-display">
                  <h3>Analyses</h3>
                  <table class="table table-striped">
                    <tr>
                      <th>Analyst</th>
                      <th>Phrase Number</th>
                      <th>Start Measure</th>
                      <th>Stop Measure</th>
                      <th>Is Cadence?</th>
                      <th>Cadence Kind</th>
                      <th>Cadence Alter</th>
                      <th></th>
                    </tr>
                    {% for analysis in analyses %}
                      <tr>
                        <td>{{ analysis.analyst }}</td>
                        <td>{{ analysis.phrase_number.phrase_num }}</td>
                        <td>{{ analysis.start_measure }}</td>
                        <td>{{ analysis.stop_measure }}</td>
                        <td>
                          {% if analysis.cadence == "Yes" %}
                            <i class="icon-ok"></i>
                          {% else %}
                            <i class="icon-remove"></i>
                          {% endif %}
                        </td>
                        <td>{{ analysis.cadence_kind }}</td>
                        <td>{{ analysis.cadence_alter }}</td>
                        <td><a href="#" class="view-analysis" anid="{{ analysis.id }}">View</a></td>
                      </tr>
                    {% endfor %}
                  </table>
                </div>
                {% endif %}
                {% if reconstructions %}
                <div class="reconstruction-display">
                  <h3>Reconstructions</h3>
                  <table class="table table-striped">
                    <tr>
                      <th>Reconstructor</th>
                      <th></th>
                    </tr>
                    {% for reconstruction in reconstructions %}
                    <tr>
                      <td>{{ reconstruction.reconstructor.surname }}</td>
                      <td><a href="#">View</a></td>
                    </tr>
                    {% endfor %}
                  </table>
                </div>
                {% endif %}
              </div>
          </div><!--/row-->
        </div><!--/span-->
      </div><!--/row-->

{% endblock %}